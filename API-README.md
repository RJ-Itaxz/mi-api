# API de Asistente Virtual - Instituto Tecnol√≥gico de Oaxaca

API REST para el proyecto de asistente virtual m√≥vil con inteligencia artificial para mejorar el aprendizaje de lenguajes de programaci√≥n en la carrera de Ingenier√≠a en Sistemas Computacionales.

## üöÄ Inicio R√°pido

### 1. Instalaci√≥n
```powershell
npm install
```

### 2. Configurar Variables de Entorno
El archivo `.env` ya est√° configurado con:
- `MONGODB_URI`: Conexi√≥n a MongoDB local
- `JWT_SECRET`: Clave secreta para tokens JWT
- `ADMIN_REG_CODE`: C√≥digo para registrar administradores

### 3. Poblar Base de Datos
```powershell
npm run seed
```

Esto crea:
- 1 usuario ADMIN
- 2 usuarios ALUMNO
- 23 ejercicios (Fundamentos de Programaci√≥n + POO)
- 5 resultados de ejemplo

### 4. Iniciar Servidor
```powershell
npm run dev
```

El servidor estar√° disponible en `http://localhost:3000`

## üë§ Credenciales de Prueba

### Administrador
- **Email**: `admin@ito.edu.mx`
- **Password**: `admin123`

### Alumnos
- **Email**: `carlos.mendoza@alumno.ito.edu.mx` | **Password**: `alumno123`
- **Email**: `maria.garcia@alumno.ito.edu.mx` | **Password**: `alumno123`

## üìö Endpoints de la API

### Autenticaci√≥n (`/api/auth`)

#### Registrar Usuario
```http
POST /api/auth/register
Content-Type: application/json

{
  "nombre": "Juan P√©rez",
  "email": "juan@alumno.ito.edu.mx",
  "password": "123456",
  "role": "ALUMNO",
  "perfil": {
    "grupo": "ISC-1A",
    "semestre": 1,
    "carrera": "ISC"
  }
}
```

**Para registrar ADMIN** (requiere c√≥digo):
```json
{
  "nombre": "Admin",
  "email": "admin@example.com",
  "password": "123456",
  "role": "ADMIN",
  "adminCode": "ITO-ADMIN-2025"
}
```

#### Login
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "admin@ito.edu.mx",
  "password": "admin123"
}
```

**Respuesta**:
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "...",
    "nombre": "Administrador ITO",
    "email": "admin@ito.edu.mx",
    "role": "ADMIN"
  }
}
```

#### Obtener Usuario Actual
```http
GET /api/auth/me
Authorization: Bearer <token>
```

### Ejercicios (`/api/ejercicios`)

#### Listar Ejercicios (p√∫blico)
```http
GET /api/ejercicios?tema=Control%20de%20Flujo&dificultad=facil&page=1&limit=10
```

**Par√°metros**:
- `tema`: Filtrar por tema
- `dificultad`: `facil`, `media`, `dificil`
- `q`: Buscar por t√≠tulo
- `page`: N√∫mero de p√°gina (default: 1)
- `limit`: Ejercicios por p√°gina (default: 10)

#### Obtener Ejercicio por ID
```http
GET /api/ejercicios/:id
```

#### Crear Ejercicio (solo ADMIN)
```http
POST /api/ejercicios
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "titulo": "Bucles anidados",
  "tema": "Control de Flujo",
  "dificultad": "media",
  "descripcion": "Implementa un patr√≥n de asteriscos usando bucles anidados."
}
```

#### Actualizar Ejercicio (solo ADMIN)
```http
PUT /api/ejercicios/:id
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "titulo": "T√≠tulo actualizado",
  "dificultad": "dificil",
  "activo": true
}
```

#### Eliminar Ejercicio (solo ADMIN)
```http
DELETE /api/ejercicios/:id
Authorization: Bearer <admin-token>
```

### Alumnos (`/api/alumnos`)

#### Obtener Perfil y Estad√≠sticas
```http
GET /api/alumnos/:id
Authorization: Bearer <token>
```
*Requiere ser el mismo alumno o ADMIN*

**Respuesta**:
```json
{
  "success": true,
  "data": {
    "alumno": {
      "_id": "...",
      "nombre": "Carlos Mendoza",
      "email": "carlos.mendoza@alumno.ito.edu.mx",
      "role": "ALUMNO",
      "perfil": {
        "grupo": "ISC-1A",
        "semestre": 1,
        "carrera": "ISC"
      }
    },
    "stats": {
      "puntos": 25,
      "correctos": 2,
      "intentos": 3
    }
  }
}
```

#### Ver Ranking del Alumno
```http
GET /api/alumnos/:id/ranking
Authorization: Bearer <token>
```

#### Ver Historial de Resultados
```http
GET /api/alumnos/:id/resultados
Authorization: Bearer <token>
```

#### Actualizar Perfil
```http
PATCH /api/alumnos/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "nombre": "Carlos Mendoza L√≥pez",
  "perfil": {
    "grupo": "ISC-2A",
    "semestre": 2
  }
}
```

### Resultados (`/api/resultados`)

#### Registrar Resultado (ALUMNO/ADMIN)
```http
POST /api/resultados
Authorization: Bearer <alumno-token>
Content-Type: application/json

{
  "ejercicio": "67890abcdef...",
  "correcto": true,
  "puntaje": 10,
  "tiempoSeg": 120,
  "detalles": {
    "intentos": 2,
    "ayudaSolicitada": false
  }
}
```

#### Ver Mis Resultados
```http
GET /api/resultados/mios
Authorization: Bearer <token>
```

#### Ranking Global
```http
GET /api/resultados/ranking?top=10
```

### Ranking (`/api/ranking`)

#### Ver Ranking (alias)
```http
GET /api/ranking?top=20
```

### LLM - Asistente Virtual (`/api/llm`)

#### Solicitar Explicaci√≥n
```http
POST /api/llm/explicacion
Authorization: Bearer <token>
Content-Type: application/json

{
  "pregunta": "¬øQu√© es un arreglo multidimensional?",
  "tema": "Organizaci√≥n de datos"
}
```

#### Solicitar Retroalimentaci√≥n
```http
POST /api/llm/feedback
Authorization: Bearer <token>
Content-Type: application/json

{
  "codigo": "int main() { printf(\"Hello\"); }",
  "lenguaje": "C"
}
```

*Nota: Actualmente devuelven respuestas simuladas. Para integrar Gemini u otro LLM real, edita `src/routes/llm.js`*

## üîê Autorizaci√≥n por Roles

| Recurso | ALUMNO | ADMIN |
|---------|--------|-------|
| Login/Register | ‚úÖ | ‚úÖ |
| Ver ejercicios | ‚úÖ | ‚úÖ |
| Resolver ejercicios | ‚úÖ | ‚ùå |
| Crear/Editar/Eliminar ejercicios | ‚ùå | ‚úÖ |
| Ver ranking | ‚úÖ | ‚úÖ |
| Ver resultados propios | ‚úÖ | ‚úÖ |
| Ver resultados de otros | ‚ùå | ‚úÖ |
| Acceso a LLM | ‚úÖ | ‚úÖ |
| Gesti√≥n de usuarios | ‚ùå | ‚úÖ |

## üìä Contenido de Ejercicios

Los ejercicios cubren los temas del plan de estudios:

### Fundamentos de Programaci√≥n
1. **Dise√±o Algor√≠tmico**: Pseudoc√≥digo, diagramas de flujo, funciones
2. **Introducci√≥n a la Programaci√≥n**: Variables, tipos de datos, operadores
3. **Control de Flujo**: Condicionales, ciclos (while, for, do-while)
4. **Organizaci√≥n de datos**: Arreglos unidimensionales/multidimensionales, estructuras
5. **Modularidad**: Funciones, paso de par√°metros

### Programaci√≥n Orientada a Objetos
1. **Clases y Objetos**: Atributos, m√©todos, encapsulamiento, constructores
2. **Herencia**: Simple y m√∫ltiple, reutilizaci√≥n
3. **Polimorfismo**: Interfaces, clases abstractas, plantillas
4. **Excepciones**: Try-catch, manejo de errores
5. **Flujos y Archivos**: Lectura/escritura de archivos

## üß™ Ejemplos PowerShell

### Login y crear ejercicio (ADMIN)
```powershell
# Login
$login = Invoke-RestMethod -Uri "http://localhost:3000/api/auth/login" -Method POST -Headers @{"Content-Type"="application/json"} -Body '{
  "email":"admin@ito.edu.mx",
  "password":"admin123"
}'

$token = $login.token
$headers = @{ "Content-Type"="application/json"; "Authorization"="Bearer $token" }

# Crear ejercicio
$ej = Invoke-RestMethod -Uri "http://localhost:3000/api/ejercicios" -Method POST -Headers $headers -Body '{
  "titulo":"Recursividad: Fibonacci",
  "tema":"Modularidad",
  "dificultad":"dificil",
  "descripcion":"Implementa la serie de Fibonacci usando recursi√≥n."
}'

Write-Host "Ejercicio creado con ID: $($ej.data._id)"
```

### Resolver ejercicio y ver ranking (ALUMNO)
```powershell
# Login alumno
$login = Invoke-RestMethod -Uri "http://localhost:3000/api/auth/login" -Method POST -Headers @{"Content-Type"="application/json"} -Body '{
  "email":"carlos.mendoza@alumno.ito.edu.mx",
  "password":"alumno123"
}'

$token = $login.token
$alumnoId = $login.user.id
$headers = @{ "Content-Type"="application/json"; "Authorization"="Bearer $token" }

# Listar ejercicios
$ejercicios = Invoke-RestMethod -Uri "http://localhost:3000/api/ejercicios?dificultad=facil&limit=1" -Method GET
$ejercicioId = $ejercicios.data[0]._id

# Registrar resultado
Invoke-RestMethod -Uri "http://localhost:3000/api/resultados" -Method POST -Headers $headers -Body "{
  `"ejercicio`":`"$ejercicioId`",
  `"correcto`":true,
  `"puntaje`":10,
  `"tiempoSeg`":90
}"

# Ver ranking
$ranking = Invoke-RestMethod -Uri "http://localhost:3000/api/ranking?top=10" -Method GET
$ranking.data | Format-Table
```

## üóÑÔ∏è Modelos de Datos

### Usuario
```javascript
{
  nombre: String,
  email: String (√∫nico),
  password: String (encriptado),
  role: 'ADMIN' | 'ALUMNO',
  perfil: {
    grupo: String,
    semestre: Number,
    carrera: String
  },
  activo: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### Ejercicio
```javascript
{
  titulo: String,
  tema: String,
  dificultad: 'facil' | 'media' | 'dificil',
  descripcion: String,
  autor: ObjectId (Usuario),
  activo: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### Resultado
```javascript
{
  alumno: ObjectId (Usuario),
  ejercicio: ObjectId (Ejercicio),
  correcto: Boolean,
  puntaje: Number,
  tiempoSeg: Number,
  detalles: Object,
  createdAt: Date,
  updatedAt: Date
}
```

## üîß Comandos √ötiles

```powershell
# Desarrollo (con auto-reload)
npm run dev

# Producci√≥n
npm start

# Poblar base de datos
npm run seed

# Ver logs de MongoDB (en MongoDB Compass)
# Conectar a: mongodb://localhost:27017
# Base de datos: mi-api-db
```

## üìÅ Estructura del Proyecto

```
mi-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js          # Configuraci√≥n MongoDB
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js              # JWT y autorizaci√≥n por roles
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Usuario.js           # Modelo de usuario
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Ejercicio.js         # Modelo de ejercicio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Resultado.js         # Modelo de resultado
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alumnos.js           # Gesti√≥n de alumnos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ejercicios.js        # CRUD de ejercicios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ resultados.js        # Registro de resultados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ranking.js           # Ranking global
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ llm.js               # Integraci√≥n con LLM
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed.js              # Script de poblaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ server.js                # Servidor principal
‚îú‚îÄ‚îÄ .env                         # Variables de entorno
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üîí Seguridad

- **JWT**: Tokens con expiraci√≥n de 7 d√≠as
- **Bcrypt**: Contrase√±as encriptadas con salt de 10 rondas
- **CORS**: Habilitado para desarrollo
- **Middlewares**: Autenticaci√≥n y autorizaci√≥n por roles
- **C√≥digo de Administrador**: Protege registro de usuarios ADMIN

## üöß Pr√≥ximas Mejoras

- [ ] Integraci√≥n real con Gemini API
- [ ] Rate limiting para endpoints de LLM
- [ ] Validaci√≥n de esquemas con Joi o Zod
- [ ] Tests unitarios y de integraci√≥n
- [ ] Paginaci√≥n mejorada con cursores
- [ ] Filtros avanzados de b√∫squeda
- [ ] Sistema de notificaciones
- [ ] Exportaci√≥n de reportes (PDF/Excel)

## üìÑ Licencia

ISC

---

**Instituto Tecnol√≥gico de Oaxaca - Ingenier√≠a en Sistemas Computacionales**
